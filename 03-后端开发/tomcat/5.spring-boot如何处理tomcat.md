<font style="color:rgb(53, 53, 53);">ä¸ºäº†æ–¹ä¾¿å¼€å‘å’Œéƒ¨ç½²ï¼ŒSpring Boot åœ¨å†…éƒ¨å¯åŠ¨äº†ä¸€ä¸ªåµŒå…¥å¼çš„ Web å®¹å™¨ã€‚æˆ‘ä»¬çŸ¥é“ Tomcat å’Œ Jetty æ˜¯ç»„ä»¶åŒ–çš„è®¾è®¡ï¼Œè¦å¯åŠ¨ Tomcat æˆ–è€… Jetty å…¶å®å°±æ˜¯å¯åŠ¨è¿™äº›ç»„ä»¶ã€‚åœ¨ Tomcat ç‹¬ç«‹éƒ¨ç½²çš„æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬é€šè¿‡ startup è„šæœ¬æ¥å¯åŠ¨ Tomcatï¼ŒTomcat ä¸­çš„ Bootstrap å’Œ Catalina ä¼šè´Ÿè´£åˆå§‹åŒ–ç±»åŠ è½½å™¨ï¼Œå¹¶è§£æ</font>`<font style="color:rgb(53, 53, 53);">server.xml</font>`<font style="color:rgb(53, 53, 53);">å’Œå¯åŠ¨è¿™äº›ç»„ä»¶ã€‚</font>

<font style="color:rgb(53, 53, 53);">åœ¨å†…åµŒå¼çš„æ¨¡å¼ä¸‹ï¼ŒBootstrap å’Œ Catalina çš„å·¥ä½œå°±ç”± Spring Boot æ¥åšäº†ï¼ŒSpring Boot è°ƒç”¨äº† Tomcat å’Œ Jetty çš„ API æ¥å¯åŠ¨è¿™äº›ç»„ä»¶ã€‚é‚£ Spring Boot å…·ä½“æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿè€Œä½œä¸ºç¨‹åºå‘˜ï¼Œæˆ‘ä»¬å¦‚ä½•å‘ SpringBoot ä¸­çš„ Tomcat æ³¨å†Œ Servlet æˆ–è€… Filter å‘¢ï¼Ÿæˆ‘ä»¬åˆå¦‚ä½•å®šåˆ¶å†…åµŒå¼çš„ Tomcatï¼Ÿä»Šå¤©æˆ‘ä»¬å°±æ¥èŠèŠè¿™äº›è¯é¢˜ã€‚</font>

## <font style="color:rgb(53, 53, 53);">Spring Boot ä¸­ Web å®¹å™¨ç›¸å…³çš„æ¥å£</font>
<font style="color:rgb(53, 53, 53);">æ—¢ç„¶è¦æ”¯æŒå¤šç§ Web å®¹å™¨ï¼ŒSpring Boot å¯¹å†…åµŒå¼ Web å®¹å™¨è¿›è¡Œäº†æŠ½è±¡ï¼Œå®šä¹‰äº†</font>**<font style="color:rgb(53, 53, 53);">WebServer</font>**<font style="color:rgb(53, 53, 53);">æ¥å£ï¼š</font>

```java
public interface WebServer {

    void start() throws WebServerException;

    void stop() throws WebServerException;

    int getPort();

}
```

<font style="color:rgb(53, 53, 53);">å„ç§ Web å®¹å™¨æ¯”å¦‚ Tomcat å’Œ Jetty éœ€è¦å»å®ç°è¿™ä¸ªæ¥å£ã€‚</font>

<font style="color:rgb(53, 53, 53);">Spring Boot è¿˜å®šä¹‰äº†ä¸€ä¸ªå·¥å‚</font>**<font style="color:rgb(53, 53, 53);">ServletWebServerFactory</font>**<font style="color:rgb(53, 53, 53);">æ¥åˆ›å»º Web å®¹å™¨ï¼Œè¿”å›çš„å¯¹è±¡å°±æ˜¯ä¸Šé¢æåˆ°çš„ WebServerã€‚</font>

```java
public interface ServletWebServerFactory {

    WebServer getWebServer(ServletContextInitializer... initializers);

}

```

<font style="color:rgb(53, 53, 53);">å¯ä»¥çœ‹åˆ° getWebServer æœ‰ä¸ªå‚æ•°ï¼Œç±»å‹æ˜¯</font>**<font style="color:rgb(53, 53, 53);">ServletContextInitializer</font>**<font style="color:rgb(53, 53, 53);">ã€‚å®ƒè¡¨ç¤º ServletContext çš„åˆå§‹åŒ–å™¨ï¼Œç”¨äº ServletContext ä¸­çš„ä¸€äº›é…ç½®ï¼š</font>

```java
public interface ServletContextInitializer {

    void onStartup(ServletContext servletContext) throws ServletException;

}
```

<font style="color:rgb(53, 53, 53);">è¿™é‡Œè¯·æ³¨æ„ï¼Œä¸Šé¢æåˆ°çš„ getWebServer æ–¹æ³•ä¼šè°ƒç”¨ ServletContextInitializer çš„ onStartup æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœä½ æƒ³åœ¨ Servlet å®¹å™¨å¯åŠ¨æ—¶åšä¸€äº›äº‹æƒ…ï¼Œæ¯”å¦‚æ³¨å†Œä½ è‡ªå·±çš„ Servletï¼Œå¯ä»¥å®ç°ä¸€ä¸ª ServletContextInitializerï¼Œåœ¨ Web å®¹å™¨å¯åŠ¨æ—¶ï¼ŒSpring Boot ä¼šæŠŠæ‰€æœ‰å®ç°äº† ServletContextInitializer æ¥å£çš„ç±»æ”¶é›†èµ·æ¥ï¼Œç»Ÿä¸€è°ƒå®ƒä»¬çš„ onStartup æ–¹æ³•ã€‚</font>

<font style="color:rgb(53, 53, 53);">ä¸ºäº†æ”¯æŒå¯¹å†…åµŒå¼ Web å®¹å™¨çš„å®šåˆ¶åŒ–ï¼ŒSpring Boot è¿˜å®šä¹‰äº†</font>**<font style="color:rgb(53, 53, 53);">WebServerFactoryCustomizerBeanPostProcessor</font>**<font style="color:rgb(53, 53, 53);">æ¥å£ï¼Œå®ƒæ˜¯ä¸€ä¸ª BeanPostProcessorï¼Œå®ƒåœ¨ postProcessBeforeInitialization è¿‡ç¨‹ä¸­å»å¯»æ‰¾ Spring å®¹å™¨ä¸­ WebServerFactoryCustomizer</font>

<font style="color:rgb(53, 53, 53);">ç±»å‹çš„ Beanï¼Œå¹¶ä¾æ¬¡è°ƒç”¨ WebServerFactoryCustomizer</font>

<font style="color:rgb(53, 53, 53);">æ¥å£çš„ customize æ–¹æ³•åšä¸€äº›å®šåˆ¶åŒ–ã€‚</font>

```java
public interface WebServerFactoryCustomizer<T extends WebServerFactory> {

    void customize(T factory);

}
```

## <font style="color:rgb(53, 53, 53);">å†…åµŒå¼ Web å®¹å™¨çš„åˆ›å»ºå’Œå¯åŠ¨</font>
<font style="color:rgb(53, 53, 53);">é“ºå«äº†è¿™äº›æ¥å£ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹ Spring Boot æ˜¯å¦‚ä½•å®ä¾‹åŒ–å’Œå¯åŠ¨ä¸€ä¸ª Web å®¹å™¨çš„ã€‚æˆ‘ä»¬çŸ¥é“ï¼ŒSpring çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ª ApplicationContextï¼Œå®ƒçš„æŠ½è±¡å®ç°ç±» AbstractApplicationContext</font>

<font style="color:rgb(53, 53, 53);">å®ç°äº†è‘—åçš„</font>**<font style="color:rgb(53, 53, 53);">refresh</font>**<font style="color:rgb(53, 53, 53);">æ–¹æ³•ï¼Œå®ƒç”¨æ¥æ–°å»ºæˆ–è€…åˆ·æ–°ä¸€ä¸ª ApplicationContextï¼Œåœ¨ refresh æ–¹æ³•ä¸­ä¼šè°ƒç”¨ onRefresh æ–¹æ³•ï¼ŒAbstractApplicationContext çš„å­ç±»å¯ä»¥é‡å†™è¿™ä¸ªæ–¹æ³• onRefresh æ–¹æ³•ï¼Œæ¥å®ç°ç‰¹å®š Context çš„åˆ·æ–°é€»è¾‘ï¼Œå› æ­¤ ServletWebServerApplicationContext å°±æ˜¯é€šè¿‡é‡å†™ onRefresh æ–¹æ³•æ¥åˆ›å»ºå†…åµŒå¼çš„ Web å®¹å™¨ï¼Œå…·ä½“åˆ›å»ºè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</font>

```java
@Override

protected void onRefresh() {

    super.onRefresh();

    try {

        // é‡å†™ onRefresh æ–¹æ³•ï¼Œè°ƒç”¨ createWebServer åˆ›å»ºå’Œå¯åŠ¨ Tomcat

        createWebServer();

    }

    catch (Throwable ex) {

    }

}



//createWebServer çš„å…·ä½“å®ç°

private void createWebServer() {

    // è¿™é‡Œ WebServer æ˜¯ Spring Boot æŠ½è±¡å‡ºæ¥çš„æ¥å£ï¼Œå…·ä½“å®ç°ç±»å°±æ˜¯ä¸åŒçš„ Web å®¹å™¨

    WebServer webServer = this.webServer;

    ServletContext servletContext = this.getServletContext();



    // å¦‚æœ Web å®¹å™¨è¿˜æ²¡åˆ›å»º

    if (webServer == null && servletContext == null) {

        // é€šè¿‡ Web å®¹å™¨å·¥å‚æ¥åˆ›å»º

        ServletWebServerFactory factory = this.getWebServerFactory();

        // æ³¨æ„ä¼ å…¥äº†ä¸€ä¸ª "SelfInitializer"

        this.webServer = factory.getWebServer(new ServletContextInitializer[]{this.getSelfInitializer()});



    } else if (servletContext != null) {

        try {

            this.getSelfInitializer().onStartup(servletContext);

        } catch (ServletException var4) {

            ...

        }

    }



    this.initPropertySources();

}
```

<font style="color:rgb(53, 53, 53);">å†æ¥çœ‹çœ‹ getWebSever å…·ä½“åšäº†ä»€ä¹ˆï¼Œä»¥ Tomcat ä¸ºä¾‹ï¼Œä¸»è¦è°ƒç”¨ Tomcat çš„ API å»åˆ›å»ºå„ç§ç»„ä»¶ï¼š</font>

```java
public WebServer getWebServer(ServletContextInitializer... initializers) {

    //1. å®ä¾‹åŒ–ä¸€ä¸ª Tomcatï¼Œå¯ä»¥ç†è§£ä¸º Server ç»„ä»¶ã€‚

    Tomcat tomcat = new Tomcat();



    //2. åˆ›å»ºä¸€ä¸ªä¸´æ—¶ç›®å½•

    File baseDir = this.baseDirectory != null ? this.baseDirectory : this.createTempDir("tomcat");

    tomcat.setBaseDir(baseDir.getAbsolutePath());



    //3. åˆå§‹åŒ–å„ç§ç»„ä»¶

    Connector connector = new Connector(this.protocol);

    tomcat.getService().addConnector(connector);

    this.customizeConnector(connector);

    tomcat.setConnector(connector);

    tomcat.getHost().setAutoDeploy(false);

    this.configureEngine(tomcat.getEngine());



    //4. åˆ›å»ºå®šåˆ¶ç‰ˆçš„ "Context" ç»„ä»¶ã€‚

    this.prepareContext(tomcat.getHost(), initializers);

    return this.getTomcatWebServer(tomcat);

}

```

<font style="color:rgb(53, 53, 53);">ä½ å¯èƒ½å¥½å¥‡ prepareContext æ–¹æ³•æ˜¯åšä»€ä¹ˆçš„å‘¢ï¼Ÿè¿™é‡Œçš„ Context æ˜¯æŒ‡</font>**<font style="color:rgb(53, 53, 53);">Tomcat ä¸­çš„ Context ç»„ä»¶</font>**<font style="color:rgb(53, 53, 53);">ï¼Œä¸ºäº†æ–¹ä¾¿æ§åˆ¶ Context ç»„ä»¶çš„è¡Œä¸ºï¼ŒSpring Boot å®šä¹‰äº†è‡ªå·±çš„ TomcatEmbeddedContextï¼Œå®ƒæ‰©å±•äº† Tomcat çš„ StandardContextï¼š</font>

```java
class TomcatEmbeddedContext extends StandardContext {}

```

## <font style="color:rgb(53, 53, 53);">æ³¨å†Œ Servlet çš„ä¸‰ç§æ–¹å¼</font>
**<font style="color:rgb(53, 53, 53);">1. Servlet æ³¨è§£</font>**

<font style="color:rgb(53, 53, 53);">åœ¨ Spring Boot å¯åŠ¨ç±»ä¸ŠåŠ ä¸Š @ServletComponentScan æ³¨è§£åï¼Œä½¿ç”¨ @WebServletã€@WebFilterã€@WebListener æ ‡è®°çš„ Servletã€Filterã€Listener å°±å¯ä»¥è‡ªåŠ¨æ³¨å†Œåˆ° Servlet å®¹å™¨ä¸­ï¼Œæ— éœ€å…¶ä»–ä»£ç ï¼Œæˆ‘ä»¬é€šè¿‡ä¸‹é¢çš„ä»£ç ç¤ºä¾‹æ¥ç†è§£ä¸€ä¸‹ã€‚</font>

```java
@SpringBootApplication

@ServletComponentScan

public class xxxApplication

{}

```

```java
@WebServlet("/hello")

public class HelloServlet extends HttpServlet {}
```

<font style="color:rgb(53, 53, 53);">åœ¨ Web åº”ç”¨çš„å…¥å£ç±»ä¸ŠåŠ ä¸Š @ServletComponentScanï¼Œ å¹¶ä¸”åœ¨ Servlet ç±»ä¸ŠåŠ ä¸Š @WebServletï¼Œè¿™æ · SpringBoot ä¼šè´Ÿè´£å°† Servlet æ³¨å†Œåˆ°å†…åµŒçš„ Tomcat ä¸­ã€‚</font>

**<font style="color:rgb(53, 53, 53);">2. ServletRegistrationBean</font>**

<font style="color:rgb(53, 53, 53);">åŒæ—¶ Spring Boot ä¹Ÿæä¾›äº† ServletRegistrationBeanã€FilterRegistrationBean å’Œ ServletListenerRegistrationBean è¿™ä¸‰ä¸ªç±»åˆ†åˆ«ç”¨æ¥æ³¨å†Œ Servletã€Filterã€Listenerã€‚å‡å¦‚è¦æ³¨å†Œä¸€ä¸ª Servletï¼Œå¯ä»¥è¿™æ ·åšï¼š</font>

```java
@Bean

public ServletRegistrationBean servletRegistrationBean() {

    return new ServletRegistrationBean(new HelloServlet(),"/hello");

}
```

<font style="color:rgb(53, 53, 53);">è¿™æ®µä»£ç å®ç°çš„æ–¹æ³•è¿”å›ä¸€ä¸ª ServletRegistrationBeanï¼Œå¹¶å°†å®ƒå½“ä½œ Bean æ³¨å†Œåˆ° Spring ä¸­ï¼Œå› æ­¤ä½ éœ€è¦æŠŠè¿™æ®µä»£ç æ”¾åˆ° Spring Boot è‡ªåŠ¨æ‰«æçš„ç›®å½•ä¸­ï¼Œæˆ–è€…æ”¾åˆ° @Configuration æ ‡è¯†çš„ç±»ä¸­ã€‚</font>

**<font style="color:rgb(53, 53, 53);">3. åŠ¨æ€æ³¨å†Œ</font>**

<font style="color:rgb(53, 53, 53);">ä½ è¿˜å¯ä»¥åˆ›å»ºä¸€ä¸ªç±»å»å®ç°å‰é¢æåˆ°çš„ ServletContextInitializer æ¥å£ï¼Œå¹¶æŠŠå®ƒæ³¨å†Œä¸ºä¸€ä¸ª Beanï¼ŒSpring Boot ä¼šè´Ÿè´£è°ƒç”¨è¿™ä¸ªæ¥å£çš„ onStartup æ–¹æ³•ã€‚</font>

```java
@Component

public class MyServletRegister implements ServletContextInitializer {



    @Override

    public void onStartup(ServletContext servletContext) {



        //Servlet 3.0 è§„èŒƒæ–°çš„ API

        ServletRegistration myServlet = servletContext

        .addServlet("HelloServlet", HelloServlet.class);



        myServlet.addMapping("/hello");



        myServlet.setInitParameter("name", "Hello Servlet");

    }



}
```

<font style="color:rgb(53, 53, 53);">è¿™é‡Œè¯·æ³¨æ„ä¸¤ç‚¹ï¼š</font>

+ <font style="color:rgb(53, 53, 53);">ServletRegistrationBean å…¶å®ä¹Ÿæ˜¯é€šè¿‡ ServletContextInitializer æ¥å®ç°çš„ï¼Œå®ƒå®ç°äº† ServletContextInitializer æ¥å£ã€‚</font>
+ <font style="color:rgb(53, 53, 53);">æ³¨æ„åˆ° onStartup æ–¹æ³•çš„å‚æ•°æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„ ServletContextï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨å®ƒçš„ addServlet æ–¹æ³•æ¥åŠ¨æ€æ³¨å†Œæ–°çš„ Servletï¼Œè¿™æ˜¯ Servlet 3.0 ä»¥åæ‰æœ‰çš„åŠŸèƒ½ã€‚</font>

## <font style="color:rgb(53, 53, 53);">Web å®¹å™¨çš„å®šåˆ¶</font>
<font style="color:rgb(53, 53, 53);">æˆ‘ä»¬å†æ¥è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯å¦‚ä½•åœ¨ Spring Boot ä¸­å®šåˆ¶ Web å®¹å™¨ã€‚åœ¨ Spring Boot 2.0 ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ¥å®šåˆ¶ Web å®¹å™¨ã€‚</font>

**<font style="color:rgb(53, 53, 53);">ç¬¬ä¸€ç§æ–¹å¼</font>**<font style="color:rgb(53, 53, 53);">æ˜¯é€šè¿‡é€šç”¨çš„ Web å®¹å™¨å·¥å‚ ConfigurableServletWebServerFactoryï¼Œæ¥å®šåˆ¶ä¸€äº› Web å®¹å™¨é€šç”¨çš„å‚æ•°ï¼š</font>

```java
@Component

public class MyGeneralCustomizer implements

WebServerFactoryCustomizer<ConfigurableServletWebServerFactory> {



    public void customize(ConfigurableServletWebServerFactory factory) {

        factory.setPort(8081);

        factory.setContextPath("/hello");

    }

}
```

**<font style="color:rgb(53, 53, 53);">ç¬¬äºŒç§æ–¹å¼</font>**<font style="color:rgb(53, 53, 53);">æ˜¯é€šè¿‡ç‰¹å®š Web å®¹å™¨çš„å·¥å‚æ¯”å¦‚ TomcatServletWebServerFactory æ¥è¿›ä¸€æ­¥å®šåˆ¶ã€‚ä¸‹é¢çš„ä¾‹å­é‡Œï¼Œæˆ‘ä»¬ç»™ Tomcat å¢åŠ ä¸€ä¸ª Valveï¼Œè¿™ä¸ª Valve çš„åŠŸèƒ½æ˜¯å‘è¯·æ±‚å¤´é‡Œæ·»åŠ  traceidï¼Œç”¨äºåˆ†å¸ƒå¼è¿½è¸ªã€‚TraceValve çš„å®šä¹‰å¦‚ä¸‹ï¼š</font>

```java
class TraceValve extends ValveBase {

    @Override

    public void invoke(Request request, Response response) throws IOException, ServletException {



        request.getCoyoteRequest().getMimeHeaders().

        addValue("traceid").setString("1234xxxxabcd");



        Valve next = getNext();

        if (null == next) {

            return;

        }



        next.invoke(request, response);

    }



}
```

<font style="color:rgb(53, 53, 53);">è·Ÿç¬¬ä¸€ç§æ–¹å¼ç±»ä¼¼ï¼Œå†æ·»åŠ ä¸€ä¸ªå®šåˆ¶å™¨ï¼Œä»£ç å¦‚ä¸‹ï¼š</font>

```java
@Component

public class MyTomcatCustomizer implements

WebServerFactoryCustomizer<TomcatServletWebServerFactory> {



    @Override

    public void customize(TomcatServletWebServerFactory factory) {

        factory.setPort(8081);

        factory.setContextPath("/hello");

        factory.addEngineValves(new TraceValve() );



    }

}
```

## <font style="color:rgb(53, 53, 53);">æœ¬æœŸç²¾å</font>
<font style="color:rgb(53, 53, 53);">ä»Šå¤©æˆ‘ä»¬å­¦ä¹ äº† Spring Boot å¦‚ä½•åˆ©ç”¨ Web å®¹å™¨çš„ API æ¥å¯åŠ¨ Web å®¹å™¨ã€å¦‚ä½•å‘ Web å®¹å™¨æ³¨å†Œ Servletï¼Œä»¥åŠå¦‚ä½•å®šåˆ¶åŒ– Web å®¹å™¨ï¼Œé™¤äº†ç»™ Web å®¹å™¨é…ç½®å‚æ•°ï¼Œè¿˜å¯ä»¥å¢åŠ æˆ–è€…ä¿®æ”¹ Web å®¹å™¨æœ¬èº«çš„ç»„ä»¶ã€‚</font>

<font style="color:rgb(53, 53, 53);"></font>

# <font style="color:rgb(53, 53, 53);">é—®é¢˜</font>
<font style="color:rgb(53, 53, 53);">æˆ‘åœ¨æ–‡ç« ä¸­æåˆ°ï¼Œé€šè¿‡ ServletContextInitializer æ¥å£å¯ä»¥å‘ Web å®¹å™¨æ³¨å†Œ Servletï¼Œé‚£ ServletContextInitializer è·Ÿ Tomcat ä¸­çš„ ServletContainerInitializer æœ‰ä»€ä¹ˆåŒºåˆ«å’Œè”ç³»å‘¢ï¼Ÿ</font>

åœ¨ **Spring Boot** ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥**ä¸æ‰‹åŠ¨æ³¨å†Œ **`**Servlet**`ï¼Œç›´æ¥ä½¿ç”¨ `@Controller` æˆ– `@RestController` å¤„ç† HTTP è¯·æ±‚ï¼Œè€Œè¿™äº› Controller æœ¬è´¨ä¸Šæ˜¯**Spring MVC æ¡†æ¶å°è£…çš„ Servlet æœºåˆ¶**ã€‚

# è§£ç­”
### **1. Tomcat ä½œä¸º Servlet å®¹å™¨**
<font style="color:rgb(53, 53, 53);">Spring Boot é»˜è®¤ä½¿ç”¨</font>**å†…åµŒ Tomcat**<font style="color:rgb(53, 53, 53);"> ä½œä¸º Web å®¹å™¨ï¼Œè€Œ Tomcat è¿è¡Œ Spring MVC æ—¶ï¼Œæœ¬è´¨ä¸Šè¿˜æ˜¯ä¾èµ– Servlet è§„èŒƒï¼Œå³ï¼š</font>

+ **Spring Boot è‡ªåŠ¨æ³¨å†Œäº† **`**DispatcherServlet**`** ä½œä¸ºå‰ç«¯æ§åˆ¶å™¨**<font style="color:rgb(53, 53, 53);">ï¼ˆFront Controllerï¼‰ã€‚</font>
+ **æ‰€æœ‰ **`**@Controller**`** æ–¹æ³•çš„è¯·æ±‚éƒ½ä¼šç»è¿‡ **`**DispatcherServlet**`** è¿›è¡Œåˆ†å‘å¤„ç†**<font style="color:rgb(53, 53, 53);">ã€‚</font>

---

### **2. **`**DispatcherServlet**`** å¦‚ä½•ä»£æ›¿åŸç”Ÿ **`**Servlet**`**ï¼Ÿ**
<font style="color:rgb(53, 53, 53);">é€šå¸¸ï¼Œåœ¨ä¼ ç»Ÿçš„ Java Web é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨æ³¨å†Œ </font>`<font style="color:rgb(53, 53, 53);">Servlet</font>`<font style="color:rgb(53, 53, 53);">ï¼Œä¾‹å¦‚ï¼š</font>

```java
@WebServlet("/hello")
public class MyServlet extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
        resp.getWriter().write("Hello Servlet");
    }
}
```

<font style="color:rgb(53, 53, 53);">ä½†åœ¨ </font>**Spring Boot**<font style="color:rgb(53, 53, 53);"> ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨ </font>`<font style="color:rgb(53, 53, 53);">@Controller</font>`<font style="color:rgb(53, 53, 53);"> ä»£æ›¿ </font>`<font style="color:rgb(53, 53, 53);">Servlet</font>`<font style="color:rgb(53, 53, 53);">ï¼š</font>

```java
@RestController
public class MyController {
    @GetMapping("/hello")
    public String hello() {
        return "Hello Spring Boot";
    }
}
```

**ä¸ºä»€ä¹ˆ **`**@Controller**`** å¯ä»¥ä»£æ›¿ **`**Servlet**`**ï¼Ÿ**

1. **Spring Boot å¯åŠ¨æ—¶è‡ªåŠ¨æ³¨å†Œ **`**DispatcherServlet**`
    - `<font style="color:rgb(53, 53, 53);">DispatcherServlet</font>`<font style="color:rgb(53, 53, 53);"> æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª</font>**ç‰¹æ®Šçš„ Servlet**<font style="color:rgb(53, 53, 53);">ï¼Œç”¨äºæ¥ç®¡æ‰€æœ‰è¯·æ±‚ï¼Œå¹¶äº¤ç»™ Spring MVC å¤„ç†ã€‚</font>
    - <font style="color:rgb(53, 53, 53);">å®ƒæ˜¯ä¸€ä¸ª </font>`**HttpServlet**`** çš„å­ç±»**<font style="color:rgb(53, 53, 53);">ï¼ŒSpring Boot å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºå¹¶æ³¨å†Œï¼š </font>

```java
@Bean
public DispatcherServlet dispatcherServlet() {
    return new DispatcherServlet();
}
```

    - **Spring Boot é»˜è®¤å°† **`**DispatcherServlet**`** æ˜ å°„åˆ° **`**/**`**ï¼ˆæ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼‰**<font style="color:rgb(53, 53, 53);">ï¼š </font>

```java
@Bean
public ServletRegistrationBean<DispatcherServlet> dispatcherRegistration(DispatcherServlet servlet) {
    return new ServletRegistrationBean<>(servlet, "/");
}
```

2. **æ‰€æœ‰ **`**@Controller**`** è¯·æ±‚ä¼šè¢« **`**DispatcherServlet**`** å¤„ç†**
    - `<font style="color:rgb(53, 53, 53);">DispatcherServlet</font>`<font style="color:rgb(53, 53, 53);"> ä½œä¸º </font>**å‰ç«¯æ§åˆ¶å™¨**<font style="color:rgb(53, 53, 53);">ï¼ˆFront Controllerï¼‰ï¼Œä¼šæ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼Œå¹¶æ ¹æ® URL æ˜ å°„åˆ°å¯¹åº”çš„ </font>`<font style="color:rgb(53, 53, 53);">@Controller</font>`<font style="color:rgb(53, 53, 53);"> æ–¹æ³•ï¼š </font>
        * `<font style="color:rgb(53, 53, 53);">/hello</font>`<font style="color:rgb(53, 53, 53);"> â†’ </font>`<font style="color:rgb(53, 53, 53);">@GetMapping("/hello")</font>`
        * `<font style="color:rgb(53, 53, 53);">/user/1</font>`<font style="color:rgb(53, 53, 53);"> â†’ </font>`<font style="color:rgb(53, 53, 53);">@GetMapping("/user/{id}")</font>`
    - <font style="color:rgb(53, 53, 53);">å®ƒçš„åº•å±‚å®ç°ç±»ä¼¼ï¼š </font>

```java
public class DispatcherServlet extends FrameworkServlet {
    protected void doService(HttpServletRequest request, HttpServletResponse response) {
        // è§£æè¯·æ±‚è·¯å¾„ï¼ŒåŒ¹é… Controller æ–¹æ³•
        HandlerMethod handler = handlerMapping.getHandler(request);
        handlerAdapter.handle(request, response, handler);
    }
}
```

---

### **3. **`**@Controller**`** vs ä¼ ç»Ÿ **`**Servlet**`
| **å¯¹æ¯”é¡¹** | **ä¼ ç»Ÿ **`**Servlet**` | **Spring Boot **`**@Controller**` |
| --- | --- | --- |
| **æ³¨å†Œæ–¹å¼** | <font style="color:rgb(53, 53, 53);">éœ€è¦ </font>`<font style="color:rgb(53, 53, 53);">@WebServlet</font>`<br/><font style="color:rgb(53, 53, 53);"> æˆ– </font>`<font style="color:rgb(53, 53, 53);">web.xml</font>`<br/><font style="color:rgb(53, 53, 53);"> é…ç½®</font> | <font style="color:rgb(53, 53, 53);">Spring Boot è‡ªåŠ¨æ³¨å†Œ </font>`<font style="color:rgb(53, 53, 53);">DispatcherServlet</font>` |
| **è¯·æ±‚åˆ†å‘** | <font style="color:rgb(53, 53, 53);">ç”± </font>`<font style="color:rgb(53, 53, 53);">HttpServlet</font>`<br/><font style="color:rgb(53, 53, 53);"> å¤„ç†è¯·æ±‚</font> | `<font style="color:rgb(53, 53, 53);">DispatcherServlet</font>`<br/><font style="color:rgb(53, 53, 53);"> è‡ªåŠ¨è§£æ </font>`<font style="color:rgb(53, 53, 53);">@RequestMapping</font>` |
| **å‚æ•°è·å–** | `<font style="color:rgb(53, 53, 53);">request.getParameter("name")</font>` | <font style="color:rgb(53, 53, 53);">æ–¹æ³•å‚æ•°è‡ªåŠ¨è§£æï¼Œå¦‚ </font>`<font style="color:rgb(53, 53, 53);">@RequestParam("name") String name</font>` |
| **è¿”å›å€¼** | <font style="color:rgb(53, 53, 53);">éœ€è¦ </font>`<font style="color:rgb(53, 53, 53);">response.getWriter().write("xxx")</font>` | <font style="color:rgb(53, 53, 53);">ç›´æ¥è¿”å› </font>`<font style="color:rgb(53, 53, 53);">String</font>`<br/><font style="color:rgb(53, 53, 53);"> æˆ– </font>`<font style="color:rgb(53, 53, 53);">JSON</font>`<br/><font style="color:rgb(53, 53, 53);">ï¼ŒSpring MVC è‡ªåŠ¨å¤„ç†</font> |
| **æ‰©å±•æ€§** | <font style="color:rgb(53, 53, 53);">é€»è¾‘ä»£ç é›†ä¸­åœ¨ </font>`<font style="color:rgb(53, 53, 53);">doGet()</font>` | <font style="color:rgb(53, 53, 53);">æ”¯æŒ </font>`<font style="color:rgb(53, 53, 53);">@GetMapping</font>`<br/><font style="color:rgb(53, 53, 53);">ã€</font>`<font style="color:rgb(53, 53, 53);">@PostMapping</font>`<br/><font style="color:rgb(53, 53, 53);">ï¼Œæ›´æ¸…æ™°</font> |


---

### **4. ç»“è®º**
+ **Spring Boot ä¸éœ€è¦æ‰‹åŠ¨æ³¨å†Œ Servlet**<font style="color:rgb(53, 53, 53);">ï¼Œå› ä¸º </font>`**DispatcherServlet**`** è‡ªåŠ¨æ³¨å†Œ**<font style="color:rgb(53, 53, 53);">ï¼Œå®ƒä¼šæ‹¦æˆªæ‰€æœ‰ HTTP è¯·æ±‚ã€‚</font>
+ `**@Controller**`** åªæ˜¯å¯¹ Servlet è¿›è¡Œäº†å°è£…**<font style="color:rgb(53, 53, 53);">ï¼Œæœ¬è´¨ä¸Š </font>`<font style="color:rgb(53, 53, 53);">@Controller</font>`<font style="color:rgb(53, 53, 53);"> å¤„ç†è¯·æ±‚çš„æ–¹å¼ä»ç„¶ä¾èµ– </font>`<font style="color:rgb(53, 53, 53);">Servlet</font>`<font style="color:rgb(53, 53, 53);"> æœºåˆ¶ã€‚</font>
+ **å¥½å¤„**<font style="color:rgb(53, 53, 53);">ï¼š </font>
    - <font style="color:rgb(53, 53, 53);">ä»£ç æ›´ç®€æ´ï¼Œä¸éœ€è¦æ‰‹å†™ </font>`<font style="color:rgb(53, 53, 53);">Servlet</font>`<font style="color:rgb(53, 53, 53);"> é€»è¾‘ã€‚</font>
    - **æ”¯æŒè‡ªåŠ¨å‚æ•°è§£æ**<font style="color:rgb(53, 53, 53);">ï¼Œä¸éœ€è¦ </font>`<font style="color:rgb(53, 53, 53);">request.getParameter()</font>`<font style="color:rgb(53, 53, 53);">ã€‚</font>
    - **æ”¯æŒ JSON ç›´æ¥è¿”å›**<font style="color:rgb(53, 53, 53);">ï¼Œæ— éœ€æ‰‹åŠ¨å†™ </font>`<font style="color:rgb(53, 53, 53);">response.getWriter()</font>`<font style="color:rgb(53, 53, 53);">ã€‚</font>

<font style="color:rgb(53, 53, 53);">è¿™æ ·ï¼ŒSpring Boot è®© Web å¼€å‘å˜å¾—æ›´ç®€å•ã€æ›´é«˜æ•ˆï¼ </font>ğŸš€



Spring Boot ä¹‹æ‰€ä»¥å¯ä»¥è¿è¡Œ `@Controller` å¹¶å¤„ç† HTTP è¯·æ±‚ï¼Œæœ¬è´¨ä¸Šä»ç„¶æ˜¯ä¾èµ– **Tomcat** æä¾›çš„ Servlet å®¹å™¨æ¥è¿è¡Œ `DispatcherServlet`ã€‚å®ƒä»¬çš„å…³ç³»å¦‚ä¸‹ï¼š

---

## **1. Tomcat åœ¨ Spring Boot ä¸­çš„ä½œç”¨**
Spring Boot é»˜è®¤ä½¿ç”¨**å†…åµŒ Tomcat** ä½œä¸º Web å®¹å™¨ï¼Œè€Œ **Tomcat æ˜¯ä¸€ä¸ª Servlet å®¹å™¨**ï¼Œç”¨äºç®¡ç†å’Œæ‰§è¡Œ `Servlet` è§„èŒƒçš„åº”ç”¨ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼š

1. **ç›‘å¬ HTTP è¯·æ±‚**
    - å¯åŠ¨ Tomcat æ—¶ï¼Œä¼šç›‘å¬æŒ‡å®šçš„ç«¯å£ï¼ˆé»˜è®¤ `8080`ï¼‰ï¼Œå¹¶ç­‰å¾… HTTP è¯·æ±‚çš„åˆ°æ¥ã€‚
2. **åˆ›å»º **`**HttpServletRequest**`** å’Œ **`**HttpServletResponse**`
    - å½“è¯·æ±‚åˆ°è¾¾æ—¶ï¼ŒTomcat è§£æ HTTP åè®®ï¼Œå°è£…æˆ `HttpServletRequest`ï¼ˆè¯·æ±‚å¯¹è±¡ï¼‰å’Œ `HttpServletResponse`ï¼ˆå“åº”å¯¹è±¡ï¼‰ã€‚
3. **è°ƒç”¨ **`**DispatcherServlet**`
    - Tomcat å‘ç° `/hello` è¿™æ ·çš„è¯·æ±‚è·¯å¾„åï¼Œä¼šè°ƒç”¨ Spring Boot è‡ªåŠ¨æ³¨å†Œçš„ `DispatcherServlet` è¿›è¡Œè¯·æ±‚åˆ†å‘ï¼š 

```java
HttpServletRequest request = new RequestFacade(req);
HttpServletResponse response = new ResponseFacade(resp);
dispatcherServlet.service(request, response);
```

4. **æœ€ç»ˆè¿”å›å“åº”**
    - `DispatcherServlet` è§£æ URLï¼Œè°ƒç”¨ `@Controller` æ–¹æ³•å¤„ç†ï¼Œå¹¶è¿”å› `Response`ï¼Œç„¶å Tomcat é€šè¿‡ `OutputStream` è¿”å› HTTP å“åº”ç»™å®¢æˆ·ç«¯ã€‚

---

## **2. Spring Boot å’Œ Tomcat ä¹‹é—´çš„å…³ç³»**
Spring Boot çš„ `spring-boot-starter-web` é»˜è®¤ä½¿ç”¨ `**Tomcat**` ä½œä¸ºå†…åµŒ Web å®¹å™¨ï¼š

+ è¿™æ„å‘³ç€ **Spring Boot é¡¹ç›®ä¸éœ€è¦æ‰‹åŠ¨å®‰è£… Tomcat**ï¼Œå®ƒ**ä¼šåœ¨å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»ºä¸€ä¸ª Tomcat æœåŠ¡å™¨**ã€‚
+ è¿è¡Œ `SpringApplication.run()` æ—¶ï¼ŒSpring Boot **å¯åŠ¨å¹¶åˆå§‹åŒ– Tomcat**ï¼š 

```java
// Spring Boot å¯åŠ¨ Tomcat
TomcatWebServer webServer = new TomcatWebServer();
webServer.start(); // ç›‘å¬ 8080 ç«¯å£
```

æ•´ä¸ªæµç¨‹å¦‚ä¸‹ï¼š

1. å¯åŠ¨ Spring Bootï¼ˆ`SpringApplication.run()`ï¼‰
2. **åˆå§‹åŒ– Tomcat**
3. **æ³¨å†Œ **`**DispatcherServlet**`** åˆ° Tomcat**
4. **Tomcat ç›‘å¬ HTTP è¯·æ±‚**
5. **è¯·æ±‚åˆ°è¾¾ Tomcatï¼Œäº¤ç»™ **`**DispatcherServlet**`** å¤„ç†**
6. `**DispatcherServlet**`** è°ƒç”¨ **`**@Controller**`** å¤„ç†è¯·æ±‚**
7. **Tomcat é€šè¿‡ **`**OutputStream**`** è¿”å› HTTP å“åº”**

---

## **3. Tomcatã€Servletã€Spring Bootã€Spring MVC çš„å…³ç³»**
å¯ä»¥ç”¨ä¸€å¼ å›¾æ¥è¡¨ç¤ºï¼š

```plain
+----------------------------+
|        æµè§ˆå™¨è¯·æ±‚          |
+----------------------------+
           â”‚
           â–¼
+----------------------------+
|        Tomcat æœåŠ¡å™¨       |   â¬… (Servlet å®¹å™¨)
+----------------------------+
           â”‚
           â–¼
+----------------------------+
|    DispatcherServlet (å‰ç«¯æ§åˆ¶å™¨) |
+----------------------------+
           â”‚
           â–¼
+----------------------------+
|     @Controller ä¸šåŠ¡é€»è¾‘   |
+----------------------------+
           â”‚
           â–¼
+----------------------------+
|   è¿”å›æ•°æ® (HTML / JSON)   |
+----------------------------+
```

+ **Tomcat**ï¼šä½œä¸º Servlet å®¹å™¨ï¼Œæ¥æ”¶ HTTP è¯·æ±‚ï¼Œå¹¶è°ƒç”¨ `DispatcherServlet`ã€‚
+ **DispatcherServlet**ï¼šSpring MVC æ ¸å¿ƒï¼Œæ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼Œå¹¶è½¬å‘åˆ° `@Controller` å¤„ç†ã€‚
+ **@Controller**ï¼šå¼€å‘è€…å®šä¹‰çš„ä¸šåŠ¡é€»è¾‘ï¼Œè¿”å›æ•°æ®ï¼ˆHTML æˆ– JSONï¼‰ã€‚
+ **æœ€ç»ˆ**ï¼šTomcat è´Ÿè´£å°†è¿”å›æ•°æ®é€šè¿‡ HTTP ä¼ è¾“å›æµè§ˆå™¨ã€‚

---

## **4. ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨ Tomcatï¼Ÿ**
åœ¨ä¼ ç»Ÿ Java Web å¼€å‘ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ï¼š

+ **æ‰‹åŠ¨å®‰è£… Tomcat**
+ **æ‰‹åŠ¨éƒ¨ç½² WAR æ–‡ä»¶**
+ **æ‰‹åŠ¨é…ç½® Servlet**

ä½† **Spring Boot å†…åµŒäº† Tomcat**ï¼Œä½¿å¾—ï¼š âœ… **ä¸ç”¨æ‰‹åŠ¨å®‰è£… Tomcat**ï¼Œç›´æ¥è¿è¡Œ `main()` æ–¹æ³•å³å¯å¯åŠ¨  
âœ… **ä¸ç”¨éƒ¨ç½² WAR**ï¼Œç›´æ¥ `java -jar` è¿è¡Œ Spring Boot åº”ç”¨  
âœ… **Spring Boot è´Ÿè´£è‡ªåŠ¨æ³¨å†Œ **`**Servlet**`ï¼Œç®€åŒ–å¼€å‘æµç¨‹

---

## **5. å¦‚ä½•æ›¿æ¢ Tomcatï¼Ÿ**
è™½ç„¶ Spring Boot é»˜è®¤ä½¿ç”¨ Tomcatï¼Œä½†æˆ‘ä»¬å¯ä»¥æ›¿æ¢æˆ **Jetty æˆ– Undertow**ï¼š

```xml
<!-- 1. æ’é™¤ Tomcat -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
    <exclusions>
        <exclusion>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-tomcat</artifactId>
        </exclusion>
    </exclusions>
</dependency>

<!-- 2. æ·»åŠ  Jetty -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-jetty</artifactId>
</dependency>
```

**è¿™æ · Spring Boot å°±ä¼šä½¿ç”¨ Jettyï¼Œè€Œä¸æ˜¯ Tomcat**ã€‚

---

## **6. æ€»ç»“**
+ **Tomcat æ˜¯ Servlet å®¹å™¨**ï¼Œå®ƒè´Ÿè´£è§£æ HTTP è¯·æ±‚ï¼Œå¹¶è°ƒç”¨ `Servlet`ã€‚
+ **Spring Boot é€šè¿‡ **`**DispatcherServlet**`** ä»£ç† **`**Servlet**`** å¤„ç†é€»è¾‘**ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ `@Controller` ä»£æ›¿ä¼ ç»Ÿ `Servlet`ã€‚
+ **Tomcat ä»ç„¶åœ¨åº•å±‚è¿è¡Œ**ï¼Œå®ƒè´Ÿè´£å¯åŠ¨ Web æœåŠ¡å™¨ï¼Œè§£æ HTTP è¯·æ±‚ï¼Œç„¶åæŠŠè¯·æ±‚äº¤ç»™ `DispatcherServlet`ã€‚
+ **Spring Boot å†…åµŒ Tomcatï¼Œä½¿å¾— Web åº”ç”¨å¯ä»¥ç”¨ **`**java -jar**`** ç›´æ¥è¿è¡Œ**ï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat æœåŠ¡å™¨ã€‚

æ‰€ä»¥ï¼Œ**Spring Boot å¹¶æ²¡æœ‰ç»•å¼€ Tomcatï¼Œè€Œæ˜¯åˆ©ç”¨ Tomcat è¿è¡Œ **`**DispatcherServlet**`**ï¼Œæœ€ç»ˆç”¨ **`**@Controller**`** å¤„ç† HTTP è¯·æ±‚**ã€‚ğŸš€



ä½ çš„æ€»ç»“å·²ç»å¾ˆè¯¦ç»†äº†ï¼Œä»¥ä¸‹æ˜¯è¿›ä¸€æ­¥ç²¾ç‚¼çš„æ ¸å¿ƒè¦ç‚¹ï¼Œæ–¹ä¾¿å¿«é€Ÿç†è§£ï¼š

---

### **1. ServletContextInitializer vs ServletContainerInitializer**
+ **ServletContextInitializerï¼ˆSpring æä¾›ï¼‰**
    - ä½œç”¨ï¼šç”¨äº Spring Boot è‡ªåŠ¨æ³¨å†Œ Servletã€Filterã€Listenerï¼Œæ— éœ€æ‰‹å†™ `web.xml`ã€‚
    - è¿è¡Œæ—¶æœºï¼šSpring Boot å¯åŠ¨æ—¶è¢« `SpringServletContainerInitializer` è°ƒç”¨ã€‚
    - ä½¿ç”¨æ–¹å¼ï¼šé€šå¸¸é€šè¿‡ `@Bean` æˆ– `SpringApplication` è‡ªåŠ¨åŠ è½½ã€‚
+ **ServletContainerInitializerï¼ˆServlet è§„èŒƒæä¾›ï¼‰**
    - ä½œç”¨ï¼šTomcat ç­‰ Web å®¹å™¨åˆå§‹åŒ– Servlet æ—¶æ‰§è¡Œï¼Œå¯ä»¥åœ¨ `META-INF/services` æ³¨å†Œã€‚
    - è¿è¡Œæ—¶æœºï¼šWeb å®¹å™¨ï¼ˆå¦‚ Tomcatï¼‰å¯åŠ¨æ—¶æ‰§è¡Œï¼Œæ‰«æ `@HandlesTypes` æ³¨è§£çš„ç±»ã€‚
    - Spring Boot é€‚é…æ–¹å¼ï¼šSpring é€šè¿‡ `SpringServletContainerInitializer` ä½œä¸ºé€‚é…å™¨ï¼Œå°†å…¶è½¬æ¢ä¸º `ServletContextInitializer` æœºåˆ¶ã€‚

---

### **2. ä¸ºä»€ä¹ˆ @Controller å¯ä»¥æ›¿ä»£ Servletï¼Ÿ**
Spring Boot é€šè¿‡ `**DispatcherServlet**` ä»£ç†äº†åŸç”Ÿ `Servlet` é€»è¾‘ï¼š

1. **Spring Boot å¯åŠ¨æ—¶è‡ªåŠ¨æ³¨å†Œ **`**DispatcherServlet**`
    - `DispatcherServlet` ç»§æ‰¿è‡ª `HttpServlet`ï¼Œæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ Servletã€‚
    - è¢«æ˜ å°„åˆ° `/`ï¼Œæ‹¦æˆªæ‰€æœ‰è¯·æ±‚å¹¶äº¤ç»™ Spring MVC å¤„ç†ã€‚
2. **è¯·æ±‚æµç¨‹**
    - Tomcat ç›‘å¬ HTTP è¯·æ±‚ï¼Œå°†å…¶äº¤ç»™ `DispatcherServlet`ã€‚
    - `DispatcherServlet` è§£æ URLï¼ŒåŒ¹é…åˆ° `@Controller` æ–¹æ³•å¹¶æ‰§è¡Œã€‚
    - ç»“æœè¿”å›ç»™ Tomcatï¼Œæœ€ç»ˆå“åº”ç»™å®¢æˆ·ç«¯ã€‚

---

### **3. Spring Bootã€Tomcatã€Spring MVC å…³ç³»**
+ **Tomcat**ï¼šä½œä¸º Servlet å®¹å™¨ï¼Œè§£æ HTTP è¯·æ±‚ï¼Œè°ƒç”¨ `DispatcherServlet` å¤„ç†ã€‚
+ **DispatcherServlet**ï¼šSpring MVC æ ¸å¿ƒï¼Œæ‹¦æˆªè¯·æ±‚ï¼Œè°ƒç”¨ `@Controller` ä¸šåŠ¡é€»è¾‘ã€‚
+ **@Controller**ï¼šç”¨æˆ·ç¼–å†™çš„ä¸šåŠ¡é€»è¾‘å±‚ï¼Œè¿”å› HTML/JSON ä½œä¸ºå“åº”ã€‚

**è¯·æ±‚å¤„ç†æµç¨‹**

1. å®¢æˆ·ç«¯è¯·æ±‚ï¼ˆæµè§ˆå™¨è®¿é—® `http://localhost:8080/hello`ï¼‰ã€‚
2. **Tomcat è§£æ HTTP è¯·æ±‚**ï¼Œåˆ›å»º `HttpServletRequest` å’Œ `HttpServletResponse`ã€‚
3. **Tomcat å°†è¯·æ±‚è½¬äº¤ç»™ **`**DispatcherServlet**` è¿›è¡Œå¤„ç†ã€‚
4. `**DispatcherServlet**`** è§£æ URLï¼ŒåŒ¹é…å¯¹åº”çš„ **`**@Controller**`** æ–¹æ³•**ï¼š 

```java
@RestController
public class MyController {
    @GetMapping("/hello")
    public String hello() {
        return "Hello Spring Boot";
    }
}
```

5. **æ–¹æ³•æ‰§è¡Œåè¿”å›æ•°æ®**ï¼Œ`DispatcherServlet` å¤„ç†å“åº”ï¼Œæœ€ç»ˆ Tomcat å‘é€å›å®¢æˆ·ç«¯ã€‚

---

### **4. Spring Boot ä¸ºä»€ä¹ˆæ¯”ä¼ ç»Ÿ Servlet æ–¹ä¾¿ï¼Ÿ**
| | ä¼ ç»Ÿ Servlet | Spring Boot `@Controller` |
| --- | --- | --- |
| **æ³¨å†Œæ–¹å¼** | `@WebServlet`<br/> æˆ– `web.xml` | Spring Boot è‡ªåŠ¨æ³¨å†Œ `DispatcherServlet` |
| **è¯·æ±‚å¤„ç†** | `HttpServlet`<br/> æ‰‹åŠ¨è§£æ `request.getParameter()` | `@RequestParam`<br/> è‡ªåŠ¨è§£æå‚æ•° |
| **è¿”å›æ•°æ®** | éœ€è¦ `response.getWriter().write("xxx")` | ç›´æ¥è¿”å› `String`<br/> æˆ– `JSON` |
| **æ‰©å±•æ€§** | é€»è¾‘é›†ä¸­åœ¨ `doGet()`<br/>ï¼Œéš¾ç»´æŠ¤ | æ”¯æŒ `@GetMapping`<br/>ï¼Œä»£ç æ›´æ¸…æ™° |


**Spring Boot ä¸»è¦ç®€åŒ–äº† Servlet å¼€å‘ï¼š**

+ âœ… **ä¸éœ€è¦æ‰‹åŠ¨æ³¨å†Œ Servlet**ï¼Œ`DispatcherServlet` è‡ªåŠ¨ä»£ç†ã€‚
+ âœ… **ç®€åŒ–å‚æ•°è§£æ**ï¼Œä¸ç”¨ `request.getParameter()`ã€‚
+ âœ… **æ”¯æŒ JSON å“åº”**ï¼Œä¸ç”¨ `response.getWriter()` æ‰‹åŠ¨è¾“å‡ºã€‚

---

### **5. å¦‚ä½•æ›¿æ¢ Tomcatï¼Ÿ**
è™½ç„¶ Spring Boot é»˜è®¤ä½¿ç”¨ Tomcatï¼Œä½†å¯ä»¥æ”¹ä¸º Jetty æˆ– Undertowï¼š

```xml
<!-- ç§»é™¤ Tomcat -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
    <exclusions>
        <exclusion>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-tomcat</artifactId>
        </exclusion>
    </exclusions>
</dependency>

<!-- æ·»åŠ  Jetty -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-jetty</artifactId>
</dependency>
```

è¿™æ · Spring Boot å°±ä¼šä½¿ç”¨ Jettyï¼Œè€Œä¸æ˜¯ Tomcatã€‚

---

### **6. æ€»ç»“**
âœ… **Tomcat æ˜¯ Spring Boot å†…åµŒçš„ Servlet å®¹å™¨**ï¼Œç”¨äºè§£æ HTTP è¯·æ±‚å¹¶è°ƒç”¨ `DispatcherServlet`ã€‚  
âœ… **Spring Boot é€šè¿‡ **`**DispatcherServlet**`** ä»£ç† Servlet é€»è¾‘**ï¼Œè®©å¼€å‘è€…å¯ä»¥ç›´æ¥ç”¨ `@Controller` å¤„ç†è¯·æ±‚ã€‚  
âœ… **Spring Boot è®© Web å¼€å‘æ›´ç®€æ´é«˜æ•ˆ**ï¼Œè‡ªåŠ¨å®Œæˆ Servlet æ³¨å†Œï¼Œæ”¯æŒå‚æ•°è§£æå’Œ JSON å“åº”ã€‚  
âœ… **å¯ä»¥æ›¿æ¢ Tomcat ä¸º Jetty æˆ– Undertow**ï¼Œé€‚é…ä¸åŒçš„ Web æœåŠ¡å™¨éœ€æ±‚ã€‚

---

è¿™æ ·ï¼ŒSpring Boot **å¹¶æ²¡æœ‰ç»•å¼€ Tomcatï¼Œè€Œæ˜¯åˆ©ç”¨ Tomcat è¿è¡Œ **`**DispatcherServlet**`**ï¼Œæœ€ç»ˆç”¨ **`**@Controller**`** å¤„ç† HTTP è¯·æ±‚**ã€‚ğŸš€

